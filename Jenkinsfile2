#!groovy

def releasedVersion

node('master') {
 def dockerTool = tool name: 'docker', type: 'org.jenkinsci.plugins.docker.commons.tools.DockerTool'
 withEnv(["DOCKER=${dockerTool}/bin"]) {
  stage('Prepare') {
   deleteDir()
   parallel Checkout: {
    checkout scm
   }, 'Run Zalenium': {
    dockerCmd ''
    'run -d --name zalenium -p 4444:4444 \
-v /var/run/docker.sock:/var/run/docker.sock \
--network="host" \
--privileged dosel/zalenium:3.4.0a start --videoRecordingEnabled true --chromeContainers 1 --firefoxContainers 0'
    ''
   }
  }
    stage('Build') {
      withMaven(maven: 'maven') {
       dir('app') {
        sh 'mvn clean'
       }
      }
     }

     stage('Tests') {
          sh 'mvn clean test verify'
         }
         }
         }
